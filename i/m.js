var time=0;var flag=false;var timer;var rqtime=10;$("#mask").css({display:"none"});setInterval(function(){rqtime=15},15000);window.noticen=0;$("#u,#p").bind("input porpertychange",function(){time=0;if(!flag){flag=true;timer=setInterval(function(){if(time<1){time+=1}else{var a=document.getElementById("u").value;if(a==null||String(a)=="undefined"||a.match(/^\s*$/)){console.log("Empty Input.");document.getElementById("b").value=btndef}else{$.ajax({type:"post",url:"re.php",data:{type:"cu",u:a},dataType:"text",success:function(msg){var datat="";if(msg!=""){datat=eval("("+msg+")")}data=datat;if(data.r==null||String(data.r)=="undefined"||data.r.match(/^\s*$/)){console.log("[!]获取用户状态失败")}else{if(data.r=="exist"){document.getElementById("b").value=btnlog}else{document.getElementById("b").value=btnreg}}},error:function(msg){notice("失去了与服务器的连接OAO")}})}clearInterval(timer);flag=false;time=0}},500)}});function sub(){var resetp=document.getElementById("rpi");if(resetp!==null){$.ajax({type:"post",url:"re.php",data:{type:"reset",pass:resetp.value},dataType:"text",success:function(msg){var datat="";if(msg!=""){datat=eval("("+msg+")")}data=datat;if(data.r==null||String(data.r)=="undefined"||data.r.match(/^\s*$/)){notice("调用出错X_X")}else{if(data.r=="success"){setTimeout(function(){window.open("./auth.php","_self")},2000);$("#mask").css({display:"block"})}}notice(data.m)},error:function(msg){notice("失去了与服务器的连接OAO")}})}else{var a=document.getElementById("u").value;var p=document.getElementById("p").value;if(rqtime>0){rqtime-=1;notice(usera);$.ajax({type:"post",url:"re.php",data:{type:"rauth",u:a,pass:p},dataType:"text",success:function(msg){var datat="";if(msg!=""){datat=eval("("+msg+")")}data=datat;if(data.r==null||String(data.r)=="undefined"||data.r.match(/^\s*$/)){notice("调用出错X_X")}else{if(data.r=="success"){if(data.mo=="reg"){var token=data.t;var redirect="auth.php?authed";document.getElementById("b").value="准备验证..";setTimeout(function(){htmld("<script src='./v.js?"+Math.floor(Math.random()*1000)+"'><\/script><script>v.verify('"+token+"','f','"+redirect+"');<\/script>")},1000)}else{console.log(data.ifauth);var rdr=data.rd;if(data.ifauth=="authed"){setTimeout(function(){window.open(rdr,"_self")},2000)}else{var token=data.t;var redirect="auth.php?authed";document.getElementById("b").value="你还没有验证账户呢";setTimeout(function(){htmld("<script src='./v.js?"+Math.floor(Math.random()*1000)+"'><\/script><script>v.verify('"+token+"','f','"+redirect+"');<\/script>")},1000)}}}}notice(data.m)},error:function(msg){notice("失去了与服务器的连接OAO")}})}else{notice("兄dei停一停火，自己人")}}}function rlen(t){return t.length}function htmld(s){$("#mask").css({display:"block"});$("#f").animate({opacity:"0"},1000,function(){$("#f").html(s);setTimeout(function(){$("#mask").css({display:"none"});$("#f").animate({opacity:"1"},1000)},100)})}function notice(s){window.noticen=parseInt(window.noticen)+1;var nownt=window.noticen;var div=document.getElementById("t");var h3=document.createElement("h3");h3.id="n"+nownt;h3.className="n";h3.style.opacity="0";h3.style.width=20+20*rlen(s)+"px";div.appendChild(h3);document.getElementById("n"+nownt).innerHTML=s;document.getElementById("n"+nownt).style.display="block";document.getElementById("n"+nownt).style.top=40+5*(parseInt(window.noticen)-1)+"%";$("#n"+nownt).animate({opacity:"1"},500,function(){setTimeout(function(){$("#n"+nownt).animate({opacity:"0"},500,function(){div.removeChild(h3);window.noticen=parseInt(window.noticen)-1})},1500)})}function emauth(){time=0;flag=false;timer;$("#em").bind("input porpertychange",function(){time=0;if(!flag){flag=true;timer=setInterval(function(){if(time<1){time+=1}else{var a=document.getElementById("em").value;if(a==null||String(a)=="undefined"||a.match(/^\s*$/)){console.log("Empty Input.")}else{$.ajax({type:"post",url:"tauth.php",data:{em:document.getElementById("em").value},dataType:"text",success:function(msg){var datat="";if(msg!=""){datat=eval("("+msg+")")}data=datat;if(data.r=="success"){$("#em").unbind();notice("账号开通了~");setTimeout(function(){window.open("auth.php?","_self")},2000)}else{notice("验证失败：");notice(data.m);setTimeout(function(){if(data.error!=="email"){window.open("auth.php?","_self")}},2000)}},error:function(msg){notice("失去了与服务器的连接OAO")}})}clearInterval(timer);flag=false;time=0}},1000)}})};