var v={};var pt,timer,times=0,authrd;v.changecode=function(){document.getElementById("vrcode").src="vc.php?"+Math.floor(Math.random()*1000)};v.verify=function(tok,e,re){authrd=re;console.log("VerifyM:"+tok);var h2=document.createElement("h2");h2.id="authimg";var obj=document.createElement("script");obj.src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js";document.getElementById(e).appendChild(obj);document.getElementById(e).appendChild(h2);$("#authimg").html("<p id='authsection' style='position:absolute;left:"+Math.floor(Math.random()*(parseInt(document.body.clientWidth)-150))+"px;top:"+Math.floor(Math.random()*(parseInt(document.body.clientHeight)-250))+"px;';><a href='javascript:void(0);' onclick='stopverify()'><img src='./i/salt.png'></img></a></p><p>请平滑快速地把鼠标移至盐罐并点击~</p>");$.ajax({type:"post",url:"saltv.php",data:{type:"getauth",m:tok},dataType:"text",success:function(msg){var datat="";if(msg!=""){datat=eval("("+msg+")")}data=datat;if(data.r=="success"){startverify()}else{h2.innerHTML="验证失败."}},error:function(msg){console.warn("服务器中断")}})};function startverify(){setTimeout(function(){$.ajax({type:"post",url:"saltv.php",data:{type:"startv",ms:pt},dataType:"text",success:function(msg){times+=1;var datat="";if(msg!=""){datat=eval("("+msg+")")}data=datat;if(data.r=="failed"){stopverify()}else{console.log(data.r)}},error:function(msg){console.warn("服务器中断")}})},1500);document.onmousemove=function(e){pt=e.pageX+"|"+e.pageY};console.log("[SaltV]Auth Start.");if(times<=6){times+=1;timer=setInterval(function(){$.ajax({type:"post",url:"saltv.php",data:{type:"startv",ms:pt},dataType:"text",success:function(msg){times+=1;var datat="";if(msg!=""){datat=eval("("+msg+")")}data=datat;if(data.r=="failed"){stopverify()}else{console.log(data.r)}},error:function(msg){console.warn("服务器中断")}})},1000)}else{stopverify()}}function judgecode(){var a=document.getElementById("verifycodeinput").value;if(a.length==6){$.ajax({type:"post",url:"saltv.php",data:{type:"vrcode",code:a},dataType:"text",success:function(msg){var datat="";if(msg!=""){datat=eval("("+msg+")")}data=datat;if(data.r=="success"){$("#verifycodeinput").unbind();$("#authimg").html("<p>验证成功~正在重定向</p>");window.open(authrd,"_self")}else{document.getElementById("verifycodeinput").value="";v.changecode()}},error:function(msg){console.warn("服务器中断")}})}}function stopverify(){document.onmousemove=function(){return false};console.log("[SaltV]Auth Counting.");times=0;clearInterval(timer);$.ajax({type:"post",url:"saltv.php",data:{type:"countv"},dataType:"text",success:function(msg){times+=1;var datat="";if(msg!=""){datat=eval("("+msg+")")}data=datat;if(data.r=="success"){$("#authimg").html("<p>验证成功~正在重定向</p>");window.open(authrd,"_self")}else{$("#authsection").remove();$("#authimg").html('<p>验证有点卡壳诶...按照箭头顺序输入下面的六位验证码<p><p><a href="javascript:void(0);" onclick="v.changecode()"><img id="vrcode" src="vc.php" style="width:80%;height:auto;"></img></a></p><p><input type="text" id="verifycodeinput" placeholder="输入验证码"></input></p><script>$("#verifycodeinput").bind(\'input porpertychange\',function(){judgecode();});<\/script>');console.log(data.r)}},error:function(msg){console.warn("服务器中断")}})};